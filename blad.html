<!DOCTYPE html>
<html lang="zh-CN">
<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Bç«™éŸ³é¢‘æå– | GitHub Pages</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
		<style>
				@keyframes spin {
						0% { transform: rotate(0deg); }
						100% { transform: rotate(360deg); }
				}
				.loading-spinner {
						animation: spin 1s linear infinite;
				}
		</style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col items-center justify-center p-4">
		<div class="w-full max-w-md bg-white rounded-lg shadow-md p-6">
				<h1 class="text-2xl font-bold text-center text-blue-600 mb-6">
						<i class="fa fa-music mr-2"></i>Bç«™éŸ³é¢‘æå–å·¥å…·
				</h1>
				
				<!-- è¾“å…¥åŒºåŸŸ -->
				<div class="mb-4">
						<label for="bilibili-url" class="block text-gray-700 mb-2">è¾“å…¥Bç«™è§†é¢‘/éŸ³é¢‘é“¾æ¥</label>
						<input 
								type="text" 
								id="bilibili-url" 
								class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
								placeholder="ç¤ºä¾‹ï¼šhttps://b23.tv/BV1CY4y1F7hP æˆ– BV1CY4y1F7hP"
						>
				</div>
				
				<!-- æäº¤æŒ‰é’® -->
				<button 
						id="submit-btn" 
						class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors mb-4 flex items-center justify-center"
				>
						<i class="fa fa-download mr-2"></i>æå–éŸ³é¢‘é“¾æ¥
				</button>
				
				<!-- åŠ è½½çŠ¶æ€ï¼ˆé»˜è®¤éšè—ï¼‰ -->
				<div id="loading" class="hidden text-center text-gray-600 mb-4">
						<i class="fa fa-spinner loading-spinner mr-2"></i>æ­£åœ¨è§£æï¼Œè¯·ç¨å€™...
				</div>
				
				<!-- ç»“æœå±•ç¤ºåŒºï¼ˆé»˜è®¤éšè—ï¼‰ -->
				<div id="result" class="hidden mb-4">
						<h3 class="text-lg font-semibold text-gray-800 mb-2">éŸ³é¢‘ä¿¡æ¯</h3>
						<div class="p-3 bg-gray-100 rounded-md break-all mb-2">
								<p class="text-sm text-gray-600">æ ‡é¢˜ï¼š<span id="audio-title" class="text-gray-800"></span></p>
								<p class="text-sm text-gray-600 mt-1">éŸ³è´¨ï¼š<span id="audio-quality" class="text-gray-800"></span></p>
								<p class="text-sm text-gray-600 mt-1">ä¸‹è½½é“¾æ¥ï¼š<span id="audio-url" class="text-blue-600"></span></p>
						</div>
						<a id="download-link" class="block mt-2 text-blue-600 hover:underline" target="_blank" rel="noopener noreferrer">
								<i class="fa fa-external-link mr-1"></i>ç‚¹å‡»ä¸‹è½½ï¼ˆé“¾æ¥æœ‰æ•ˆæœŸçº¦2å°æ—¶ï¼‰
						</a>
				</div>
				
				<!-- é”™è¯¯æç¤ºï¼ˆé»˜è®¤éšè—ï¼‰ -->
				<div id="error" class="hidden text-red-600 text-center mb-4"></div>
				
				<!-- æç¤ºä¿¡æ¯ -->
				<div class="text-xs text-gray-500 text-center mt-4">
						<p>âš ï¸ ä»…ç”¨äºä¸ªäººå­¦ä¹ ï¼Œè¯·å‹¿å•†ç”¨ï¼Œå°Šé‡ç‰ˆæƒ</p>
						<p>ğŸ”— æ”¯æŒBVå·ã€b23.tvçŸ­é“¾ã€å®Œæ•´è§†é¢‘é“¾æ¥</p>
				</div>
		</div>

		<script>
				// ========== å…³é”®ä¿®æ”¹ï¼šæ›¿æ¢ä¸ºä½ çš„æ¥å£åœ°å€ ==========
				const API_BASE_URL = 'https://blad.mobike.workers.dev';
				// ======================================================

				// è·å–DOMå…ƒç´ 
				const submitBtn = document.getElementById('submit-btn');
				const bilibiliUrlInput = document.getElementById('bilibili-url');
				const loading = document.getElementById('loading');
				const result = document.getElementById('result');
				const audioTitle = document.getElementById('audio-title');
				const audioQuality = document.getElementById('audio-quality');
				const audioUrl = document.getElementById('audio-url');
				const downloadLink = document.getElementById('download-link');
				const error = document.getElementById('error');

				// è§£æBç«™é“¾æ¥çš„æ ¸å¿ƒå‡½æ•°
				async function parseBilibiliAudio(url) {
						try {
								// éšè—ä¹‹å‰çš„ç»“æœå’Œé”™è¯¯
								result.classList.add('hidden');
								error.classList.add('hidden');
								
								// æ˜¾ç¤ºåŠ è½½çŠ¶æ€
								loading.classList.remove('hidden');
								submitBtn.disabled = true;

								// è°ƒç”¨è‡ªå»ºçš„Vercelæ¥å£
								const response = await fetch(`${API_BASE_URL}?url=${encodeURIComponent(url)}`);
								const data = await response.json();
								
								// æ£€æŸ¥æ¥å£è¿”å›æ˜¯å¦æˆåŠŸ
								if (data.code !== 200) {
										throw new Error(data.msg || 'è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥');
								}

								// æ˜¾ç¤ºéŸ³é¢‘ä¿¡æ¯
								audioTitle.textContent = data.data.title || 'æœªçŸ¥æ ‡é¢˜';
								audioQuality.textContent = data.data.quality || 'æœªçŸ¥éŸ³è´¨';
								audioUrl.textContent = data.data.audio;
								downloadLink.href = data.data.audio;
								result.classList.remove('hidden');

						} catch (err) {
								// æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
								error.textContent = err.message;
								error.classList.remove('hidden');
						} finally {
								// éšè—åŠ è½½çŠ¶æ€ï¼Œæ¢å¤æŒ‰é’®
								loading.classList.add('hidden');
								submitBtn.disabled = false;
						}
				}

				// æäº¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
				submitBtn.addEventListener('click', () => {
						const url = bilibiliUrlInput.value.trim();
						
						// ç®€å•éªŒè¯é“¾æ¥
						if (!url) {
								error.textContent = 'è¯·è¾“å…¥Bç«™è§†é¢‘/éŸ³é¢‘é“¾æ¥';
								error.classList.remove('hidden');
								return;
						}

						// è°ƒç”¨è§£æå‡½æ•°
						parseBilibiliAudio(url);
				});

				// å›è½¦æäº¤
				bilibiliUrlInput.addEventListener('keypress', (e) => {
						if (e.key === 'Enter') {
								submitBtn.click();
						}
				});
		</script>
</body>
</html>
